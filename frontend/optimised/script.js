var device_status_element=document.getElementById("device-status"),button_ids=[];function btn_flip(t){console.log("clicked");let e=document.getElementById(t.srcElement.id),n=e.getAttribute("data-pin"),o=e.getAttribute("data-status");if("WAITING"==e.textContent)return!1;e.textContent="WAITING",fetch(`/flipstatus?pin=${n}`).then(t=>(t.ok||failure_handler(e,o),json.response())).then(t=>{t.error?failure_handler(e,o):"OFF"==e.textContent?(e.textContent="ON",e.setAttribute("data-status","on")):(e.textContent="OFF",e.setAttribute("data-status","off"))}).catch(t=>{console.error(t),failure_handler(e,o)})}function failure_handler(t,e){t.textContent="FAILED",setTimeout(()=>{t.textContent=e.toUpperCase()},1500)}fetch("/devices.json").then(t=>t.json()).then(t=>{let e=document.getElementById("device-list");t.error?device_status_element.innerHTML="backend error":(t.devices.forEach((t,n)=>{device_status_element.textContent="";let o=document.createElement("div"),i=document.createElement("h1"),d=document.createElement("button");o.classList.add("device-child-container"),i.textContent=t.name,d.textContent=t.high?"ON":"OFF",d.setAttribute("data-status",t.high?"on":"off"),d.setAttribute("data-pin",t.pin);let s=`${t.pin}-${n}`;d.setAttribute("id",s),button_ids.push(s),o.append(i),o.append(d),e.append(o)}),button_ids.forEach(t=>{console.log("adding event listener for id: "+t),document.getElementById(t).addEventListener("click",btn_flip)}))}).catch(t=>{console.error(t),device_status_element.textContent="devices fetch error"});
