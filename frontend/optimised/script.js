var device_status_element=document.getElementById("device-status"),button_ids=[];function btn_flip(t){console.log("clicked");let e=document.getElementById(t.srcElement.id),n=e.getAttribute("data-pin"),i=e.getAttribute("data-status");if("WAITING"==e.textContent)return!1;e.textContent="WAITING",fetch(`/flipstatus?pin=${n}`).then(t=>(t.ok||failure_handler(e,i),json.response())).then(t=>{t.error?failure_handler(e,i):"OFF"==e.textContent?(e.textContent="ON",e.setAttribute("data-status","on")):(e.textContent="OFF",e.setAttribute("data-status","off"))}).catch(()=>{failure_handler(e,i)})}function failure_handler(t,e){t.textContent="FAILED",setTimeout(()=>{t.textContent=e.toUpperCase()},1500)}fetch("/devices").then(t=>t.json()).then(t=>{let e=document.getElementById("device-list");t.error?device_status_element.innerHTML="backend error":(t.devices.forEach((t,n)=>{device_status_element.textContent="";let i=document.createElement("div"),o=document.createElement("h1"),d=document.createElement("button");i.classList.add("device-child-container"),o.textContent=t.name,d.textContent=t.high?"ON":"OFF",d.setAttribute("data-status",t.high?"on":"off"),d.setAttribute("data-pin",t.pin);let a=`${t.pin}-${n}`;d.setAttribute("id",a),button_ids.push(a),i.append(o),i.append(d),e.append(i)}),button_ids.forEach(t=>{console.log("adding event listener for id: "+t),document.getElementById(t).addEventListener("click",btn_flip)}))}).catch(t=>{console.error(t),device_status_element.textContent="devices fetch error"});
